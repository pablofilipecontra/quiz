<!DOCTYPE html>

<html lang="pt-BR">
  <head>
    <meta charset="UTF-8">
    <title>Cidade do Usuário</title>
  </head>

  <body>
    <h1 id="city-title">Carregando sua cidade...</h1>
    <code>
      <pre id="json-output"></pre>
    </code>

    <script>
      const cityTitle = document.getElementById('city-title');
      const jsonOutput = document.getElementById('json-output');

      const savedCity = localStorage.getItem('user_city');

      if (savedCity) {
        cityTitle.innerText = `Você está acessando de ${savedCity}`;
      }

      // SEMPRE busca o JSON
      fetch('https://ipapi.co/json/')
        .then(response => response.json())
        .then(data => {
          // Mostra o JSON
          jsonOutput.innerText = JSON.stringify(data, null, 2);

          // Atualiza cidade se ainda não existir
          if (!savedCity && data.city) {
            localStorage.setItem('user_city', data.city);
            cityTitle.innerText = `Você está acessando de ${data.city}`;
          }
        })
        .catch(err => {
          console.error('Erro ao obter localização', err);
          cityTitle.innerText = 'Bem-vindo!';
        });
    </script>
  </body>
</html>